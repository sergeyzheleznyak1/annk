document.addEventListener("alpine:init",()=>{Alpine.data("CartItems",()=>({itemsRoot:null,loading:null,init(){this.itemsRoot=this.$root,window.addEventListener("baseline:cart:afteradditem",this.onCartQuantityChange.bind(this)),window.addEventListener("baseline:cart:cartqtychange",this.onCartQuantityChange.bind(this))},onCartQuantityChange(e){Alpine.morph(this.itemsRoot,querySelectorInHTMLString("[data-cart-items]",e.detail.response.sections["cart-items"]).outerHTML),this.$nextTick(()=>{this.itemsRoot.querySelectorAll("input").forEach(inputEl=>{inputEl.value=inputEl.getAttribute("value"),inputEl.dispatchEvent(new Event("input"))})}),this.updateLiveRegion(parseDOMFromString(e.detail.response.sections["cart-live-region"]).firstElementChild.textContent),e.detail.originalTarget&&this.$nextTick(()=>{if(!this.itemsRoot.contains(e.detail.originalTarget)){let focusRoot;this.itemsRoot.closest('[role="dialog"]')?focusRoot=this.itemsRoot.closest('[role="dialog"]').parentNode:focusRoot=this.itemsRoot,this.$focus.within(focusRoot).first()}})},updateLiveRegion(liveRegionText){if(!liveRegionText)return;const cartStatus=document.getElementById("cart-live-region-text");cartStatus.textContent=liveRegionText,cartStatus.setAttribute("aria-hidden",!1),setTimeout(()=>{cartStatus.setAttribute("aria-hidden",!0)},1e3)}})),Alpine.data("CartItem",key=>({quantity:null,previousQuantity:null,key,locked:!1,errorMessage:null,async itemQuantityChange(){if(this.locked||this.loading||this.$refs.quantityInput.hasAttribute("data-last-value")&&this.quantity===Number(this.$refs.quantityInput.dataset.lastValue))return;this.locked=!0,this.loading=!0;const request={...fetchConfigDefaults("application/javascript"),body:JSON.stringify({id:this.key,quantity:this.quantity,sections:"cart-items,cart-footer,cart-item-count,cart-live-region",sections_url:window.location.pathname})};try{const data=await(await fetch(theme.routes.cart_change_url,request)).json();data.status===422?(this.errorMessage=data.message,this.quantity=this.previousQuantity):(this.errorMessage=null,document.body.dispatchEvent(new CustomEvent("baseline:cart:cartqtychange",{bubbles:!0,detail:{response:data,originalTarget:this.$root}})))}catch(e){console.error(e),document.getElementById("cart-errors").textContent=theme.strings.cartError}finally{this.locked=!1,this.loading=!1}},removeItem(){Array.from(this.$root.querySelectorAll('[x-data="CartItemQuantity"]')).filter(el=>el.offsetParent)[0].dispatchEvent(new CustomEvent("remove"))}})),Alpine.data("CartItemQuantity",()=>({init(){this.$root.addEventListener("remove",()=>{this.remove()})},remove(){this.adjustQuantity(()=>{this.$refs.quantityInput.value=0})},...coreQuantity}))});
//# sourceMappingURL=/cdn/shop/t/2/assets/cart-items.js.map?v=180899861962283955421722327237
